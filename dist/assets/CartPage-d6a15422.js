import{u as e,r as t,j as s,n as a,F as i,s as r,o as n,p as o,t as l,a as c}from"./index-8cb3ece3.js";import{r as d,b as m,u as x,L as u}from"./vendor-1b10af89.js";import{u as h}from"./notificationStore-506eda04.js";import{m as p,A as f}from"./ui-55e5424c.js";import"./utils-915a2c87.js";const g=({products:g,updateProductStock:j})=>{const{items:y,removeItem:b,updateQuantity:N,clearCart:v,getCartTotal:k,getItemCount:w}=e(),{isAuthenticated:C}=t(),{addNotification:S}=h(),[T,q]=d.useState(!0),[I,P]=d.useState(null),[O,A]=d.useState(!1),F=m(),L=x(),Y="true"===new URLSearchParams(F.search).get("orderConfirmed"),[R,U]=d.useState(!1),$=k(),z=0===w(),B=z?0:7,E=$+B;d.useEffect((()=>{const e="true"===sessionStorage.getItem("orderCompleted");if(Y||e){U(!0),Y&&!e&&sessionStorage.setItem("orderCompleted","true");const t=setTimeout((()=>{L("/purchase-confirmation",{replace:!0}),setTimeout((()=>{sessionStorage.removeItem("orderCompleted")}),1e3)}),100);return()=>clearTimeout(t)}const t=setTimeout((()=>{q(!1)}),600);return()=>clearTimeout(t)}),[Y,L]);const H=(e,t)=>{const s=Math.max(1,e.quantity+t);if(g){const a=g.find((t=>t.id===e.id));if(t>0&&a&&s>a.stock)return void S({type:"error",message:`Sorry, only ${a.stock} units available for this product.`})}N(e.id,s)};return T||R?s.jsx("div",{className:"pt-24 pb-16 container",children:s.jsx("div",{className:"flex justify-center items-center h-96",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})})}):s.jsx("div",{className:"pt-24 pb-16",children:s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[s.jsx(p.h1,{className:"text-3xl font-bold text-center lg:text-left",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:"Your Shopping Cart"}),s.jsxs(u,{to:"/products",className:"flex items-center text-primary-600 hover:underline",children:[s.jsx(a,{className:"mr-2"})," Continue Shopping"]})]}),z?s.jsxs(p.div,{className:"text-center py-16 bg-gray-50 rounded-lg",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[s.jsx(i,{className:"text-5xl text-gray-400 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your cart is empty"}),s.jsx("p",{className:"text-gray-600 mb-8",children:"Looks like you haven't added any products to your cart yet."}),s.jsx(u,{to:"/products",className:"btn btn-primary",children:"Start Shopping"})]}):s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx(p.div,{className:"lg:col-span-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:s.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[s.jsx("div",{className:"p-6 border-b border-gray-200",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h2",{className:"text-xl font-bold",children:["Cart Items (",y.length,")"]}),s.jsx("button",{onClick:()=>A(!0),className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Clear Cart"}),O&&s.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full",children:[s.jsx("h3",{className:"text-xl font-bold mb-4",children:"Clear Your Cart?"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to remove all items from your cart? This action cannot be undone."}),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100",children:"Cancel"}),s.jsx("button",{onClick:()=>{v(),A(!1)},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Clear Cart"})]})]})})]})}),s.jsx(f,{children:y.map((e=>s.jsxs(p.div,{className:"p-6 border-b border-gray-200 flex flex-col sm:flex-row gap-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,height:0,marginTop:0,marginBottom:0,padding:0},transition:{duration:.3},style:{opacity:I===e.id?.5:1},children:[s.jsx("div",{className:"w-full sm:w-24 h-24 bg-gray-100 rounded-md overflow-hidden",children:s.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-bold text-lg mb-1",children:e.name}),s.jsx("p",{className:"text-gray-500 text-sm mb-2",children:e.category}),s.jsx("div",{className:"mt-1 text-sm text-gray-500",children:s.jsxs("span",{className:"block sm:inline",children:["Price: ",r(e.price)]})}),g&&s.jsx(s.Fragment,{children:(()=>{const t=g.find((t=>t.id===e.id));if(t){const e=t.stock<10;if(0===t.stock)return s.jsx("div",{className:"mt-1 text-red-600 text-sm font-medium",children:"Out of stock"});if(e)return s.jsxs("div",{className:"mt-1 text-amber-600 text-sm",children:["Only ",t.stock," left in stock"]})}return null})()}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{onClick:()=>H(e,-1),className:"p-1 rounded-full hover:bg-gray-100",disabled:e.quantity<=1,children:s.jsx(n,{className:"text-gray-500"})}),s.jsx("span",{className:"mx-2 w-8 text-center",children:e.quantity}),s.jsx("button",{onClick:()=>H(e,1),className:"p-1 rounded-full hover:bg-gray-100",disabled:g&&(()=>{const t=g.find((t=>t.id===e.id));return t&&e.quantity>=t.stock})(),children:s.jsx(o,{className:""+(g&&(()=>{const t=g.find((t=>t.id===e.id));return t&&e.quantity>=t.stock})()?"text-gray-300":"text-gray-500")})})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("span",{className:"font-bold",children:r(e.price*e.quantity)}),s.jsx("button",{onClick:()=>{return t=e.id,P(t),void setTimeout((()=>{b(t),P(null)}),300);var t},className:"text-red-500 hover:text-red-700","aria-label":`Remove ${e.name} from cart`,children:s.jsx(l,{})})]})]})]})]},e.id)))})]})}),s.jsx(p.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5},children:s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-24",children:[s.jsx("h2",{className:"text-xl font-bold mb-6",children:"Order Summary"}),s.jsxs("div",{className:"space-y-4 mb-6",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotal"}),s.jsx("span",{className:"font-medium",children:r($)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Shipping"}),s.jsx("span",{className:"font-medium",children:0===B?"Free":r(B)})]}),s.jsxs("div",{className:"border-t border-gray-200 pt-4 flex justify-between",children:[s.jsx("span",{className:"font-bold",children:"Total"}),s.jsx("span",{className:"font-bold text-xl",children:r(E)})]})]}),s.jsxs(p.button,{onClick:()=>(console.log("Proceeding to checkout..."),C?g&&y.some((e=>{const t=g.find((t=>t.id===e.id));return!t||t.stock<e.quantity}))?(console.log("Some items are out of stock"),void S({type:"error",message:"Some items in your cart are out of stock or have insufficient quantity."})):(sessionStorage.setItem("orderItems",JSON.stringify(y)),console.log("Navigating to checkout page"),void L("/checkout")):(console.log("User not authenticated, redirecting to login"),S({type:"error",message:"Please log in to checkout"}),void L("/login",{state:{from:"/checkout"}}))),className:"btn btn-primary w-full flex items-center justify-center gap-2 "+(g&&y.some((e=>{const t=g.find((t=>t.id===e.id));return t&&t.stock<e.quantity}))?"opacity-50 cursor-not-allowed":""),whileHover:{scale:1.02},whileTap:{scale:.98},children:["Proceed to Checkout ",s.jsx(c,{})]})]})})]})]})})};export{g as default};
