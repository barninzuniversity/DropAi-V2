import{u as e,j as s,v as t,s as a,n as i,_ as r}from"./index-8cb3ece3.js";import{u as n,r as l,L as o}from"./vendor-1b10af89.js";import{u as d}from"./notificationStore-506eda04.js";import{m as c}from"./ui-55e5424c.js";import"./utils-915a2c87.js";const m=({products:m,updateProductStock:u})=>{const x=n(),{items:h,getCartTotal:p,getCartOriginalTotal:g,getCartSavings:j,clearCart:f}=e(),{addNotification:N}=d(),[y,b]=l.useState(!0),[v,S]=l.useState(!1),[w,C]=l.useState(!1),[k,I]=l.useState({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:"Tunisia"});l.useEffect((()=>{const e=sessionStorage.getItem("orderCompleted");0!==h.length||w||e||x("/cart");const s=setTimeout((()=>{b(!1)}),600);return()=>clearTimeout(s)}),[h,x,w]);const D=p(),O=g(),T=j(),q=D+7,P=e=>{const{name:s,value:t}=e.target;I((e=>({...e,[s]:t})))},F=e=>{m&&u&&e.forEach((e=>{const s=m.find((s=>s.id===e.id));if(s){const t=Math.max(0,s.stock-e.quantity);u(e.id,t),console.log(`Updated stock for ${e.name}: ${s.stock} -> ${t}`),t<5&&t>0?N({type:"info",message:`Low stock alert: Only ${t} units of "${e.name}" remaining.`}):0===t&&N({type:"warning",message:`"${e.name}" is now out of stock.`})}}))};return y?s.jsx("div",{className:"pt-24 pb-16 container",children:s.jsx("div",{className:"flex justify-center items-center h-96",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})})}):w?s.jsx("div",{className:"pt-24 pb-16",children:s.jsx("div",{className:"container max-w-3xl mx-auto",children:s.jsxs(c.div,{className:"bg-white rounded-lg shadow-md p-8 text-center",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},children:[s.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(t,{className:"text-green-600 text-3xl"})}),s.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Order Confirmed!"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Thank you for your purchase. Your order has been received and is being processed. You will receive a confirmation email shortly."}),s.jsxs("p",{className:"text-amber-600 mb-8 text-sm font-medium",children:["If you don't receive an order confirmation email within 6 hours, please contact us at ",s.jsx("a",{href:"mailto:barninzshop@gmail.com",className:"underline hover:text-amber-700",children:"barninzshop@gmail.com"})]}),s.jsxs("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg",children:[s.jsx("h3",{className:"font-bold mb-2",children:"Order Summary"}),s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"Order Number:"}),s.jsx("span",{className:"font-medium",children:sessionStorage.getItem("orderNumber")||"ORD-"+Math.floor(1e4*Math.random()).toString().padStart(4,"0")})]}),s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"Order Date:"}),s.jsx("span",{className:"font-medium",children:sessionStorage.getItem("orderDate")||(new Date).toLocaleDateString()})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Amount:"}),s.jsx("span",{className:"font-bold",children:sessionStorage.getItem("orderTotal")?`${sessionStorage.getItem("orderTotal")} TND`:a(q)})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[s.jsx(o,{to:"/products",className:"btn btn-primary",children:"Continue Shopping"}),s.jsx(o,{to:"/",className:"btn btn-outline",children:"Back to Home"})]})]})})}):s.jsx("div",{className:"pt-24 pb-16",children:s.jsxs("div",{className:"container",children:[s.jsx("div",{className:"mb-8",children:s.jsxs(o,{to:"/cart",className:"flex items-center text-primary-600 hover:underline",children:[s.jsx(i,{className:"mr-2"})," Back to Cart"]})}),s.jsx(c.h1,{className:"text-3xl font-bold mb-8 text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:"Checkout"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-6xl mx-auto",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx(c.div,{className:"bg-white rounded-lg shadow-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),S(!0);const s=(()=>{if(!m)return{success:!0,insufficientItems:[]};const e=[];for(const s of h){const t=m.find((e=>e.id===s.id));t?t.stock<s.quantity&&e.push({id:s.id,name:s.name,requested:s.quantity,available:t.stock,message:`Only ${t.stock} units available`}):e.push({id:s.id,name:s.name,message:"Product not found in inventory"})}return{success:0===e.length,insufficientItems:e}})();if(!s.success)return S(!1),N({type:"error",message:"Some items in your cart are out of stock"}),sessionStorage.setItem("insufficientItems",JSON.stringify(s.insufficientItems)),void x("/cart");const t={customer:{firstName:k.firstName,lastName:k.lastName,email:k.email,phone:k.phone,address:k.address,city:k.city,state:k.state,zipCode:k.zipCode,country:k.country},items:h.map((e=>{const s=e.finalPrice||e.price,t=e.originalPrice||e.price,a=e.discountPercentage||0;return{...e,finalPrice:s,originalPrice:t,discountPercentage:a,itemTotal:s*e.quantity,savings:t!==s?(t-s)*e.quantity:0}})),payment:{method:"Cash on Delivery",subtotal:D,originalSubtotal:O,totalSavings:T,shipping:7,total:q,status:"Pending - Payment on Delivery"},orderDate:(new Date).toISOString(),orderNumber:"ORD-"+Math.floor(1e4*Math.random()).toString().padStart(4,"0")};try{sessionStorage.setItem("orderItems",JSON.stringify(h)),F(h);try{const{sendOrderNotification:e}=await r((()=>import("./emailService-29aaf775.js")),[]),s=await e(t);s&&!1===s.success&&console.error("Email notification failed:",s.error)}catch(a){console.error("Email service error:",a)}setTimeout((()=>{sessionStorage.setItem("orderCompleted","true"),sessionStorage.setItem("orderNumber",t.orderNumber),sessionStorage.setItem("orderDate",(new Date).toLocaleDateString()),sessionStorage.setItem("orderTotal",q.toFixed(2)),S(!1),C(!0),f()}),1500)}catch(i){console.error("Order process error:",i),sessionStorage.setItem("orderItems",JSON.stringify(h)),F(h),setTimeout((()=>{sessionStorage.setItem("orderCompleted","true"),sessionStorage.setItem("orderNumber",t.orderNumber),sessionStorage.setItem("orderDate",(new Date).toLocaleDateString()),sessionStorage.setItem("orderTotal",q.toFixed(2)),S(!1),C(!0),f()}),1500)}},children:[s.jsx("div",{className:"p-6 border-b border-gray-200",children:s.jsx("h2",{className:"text-xl font-bold",children:"Shipping Information"})}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"firstName",className:"block text-gray-700 font-medium mb-2",children:"First Name"}),s.jsx("input",{type:"text",id:"firstName",name:"firstName",value:k.firstName,onChange:P,className:"input",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"lastName",className:"block text-gray-700 font-medium mb-2",children:"Last Name"}),s.jsx("input",{type:"text",id:"lastName",name:"lastName",value:k.lastName,onChange:P,className:"input",required:!0})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-medium mb-2",children:"Email Address"}),s.jsx("input",{type:"email",id:"email",name:"email",value:k.email,onChange:P,className:"input",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"phone",className:"block text-gray-700 font-medium mb-2",children:"Phone Number"}),s.jsx("input",{type:"tel",id:"phone",name:"phone",value:k.phone,onChange:P,className:"input",required:!0})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"address",className:"block text-gray-700 font-medium mb-2",children:"Address"}),s.jsx("input",{type:"text",id:"address",name:"address",value:k.address,onChange:P,className:"input",required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"col-span-2",children:[s.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-medium mb-2",children:"City"}),s.jsx("input",{type:"text",id:"city",name:"city",value:k.city,onChange:P,className:"input",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-medium mb-2",children:"State"}),s.jsx("input",{type:"text",id:"state",name:"state",value:k.state,onChange:P,className:"input",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"zipCode",className:"block text-gray-700 font-medium mb-2",children:"ZIP Code"}),s.jsx("input",{type:"text",id:"zipCode",name:"zipCode",value:k.zipCode,onChange:P,className:"input",required:!0})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-medium mb-2",children:"Country"}),s.jsxs("select",{id:"country",name:"country",value:k.country,onChange:P,className:"input",required:!0,children:[s.jsx("option",{value:"Tunisia",children:"Tunisia"}),s.jsx("option",{value:"United States",children:"United States"}),s.jsx("option",{value:"Canada",children:"Canada"}),s.jsx("option",{value:"United Kingdom",children:"United Kingdom"}),s.jsx("option",{value:"Australia",children:"Australia"}),s.jsx("option",{value:"France",children:"France"}),s.jsx("option",{value:"Germany",children:"Germany"}),s.jsx("option",{value:"Japan",children:"Japan"})]})]})]}),s.jsx("div",{className:"p-6 bg-gray-50 flex justify-end",children:s.jsx(c.button,{type:"submit",className:"btn btn-primary",whileHover:{scale:1.02},whileTap:{scale:.98},disabled:v,children:v?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-t-2 border-b-2 border-white rounded-full"}),"Processing..."]}):"Complete Order (Cash on Delivery)"})})]})})}),s.jsx(c.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5},children:s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-24",children:[s.jsx("h2",{className:"text-xl font-bold mb-6",children:"Order Summary"}),s.jsxs("div",{className:"space-y-4 mb-6",children:[s.jsx("div",{className:"max-h-60 overflow-y-auto mb-4",children:h.map((e=>{const t=e.finalPrice||e.price,i=e.originalPrice||e.price,r=i>t,n=r?Math.round(100*(1-t/i)):0,l=m?m.find((s=>s.id===e.id)):null,o=l&&l.stock<10&&l.stock>0,d=l&&0===l.stock,c=l&&l.stock<e.quantity;return s.jsxs("div",{className:"flex items-center py-2 border-b border-gray-100",children:[s.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-md overflow-hidden mr-3",children:e.image?s.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="/placeholder-product.png"}}):s.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200 text-gray-400 text-xs",children:"No image"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-medium",children:e.name}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("span",{children:["Qty: ",e.quantity]}),s.jsx("span",{className:"font-medium",children:a(t*e.quantity)})]}),r&&s.jsxs("div",{className:"text-xs text-right",children:[s.jsx("span",{className:"line-through text-gray-500",children:a(i*e.quantity)}),s.jsxs("span",{className:"ml-1 text-red-500",children:["(",n,"% off)"]})]}),d&&s.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Out of stock"}),!d&&c&&s.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Only ",l.stock," available"]}),!c&&o&&s.jsxs("div",{className:"text-xs text-amber-600 mt-1",children:["Low stock: ",l.stock," left"]})]})]},e.id)}))}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotal"}),s.jsx("span",{className:"font-medium",children:a(D)})]}),T>0&&s.jsxs("div",{className:"flex justify-between text-green-600",children:[s.jsx("span",{children:"Savings"}),s.jsxs("span",{children:["-",a(T)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Shipping"}),s.jsx("span",{className:"font-medium",children:a(7)})]}),s.jsxs("div",{className:"border-t border-gray-200 pt-4 flex justify-between",children:[s.jsx("span",{className:"font-bold",children:"Total"}),s.jsx("span",{className:"font-bold text-xl",children:a(q)})]})]})]})})]})]})})};export{m as default};
