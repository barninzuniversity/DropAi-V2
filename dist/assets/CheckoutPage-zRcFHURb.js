import{u as e,m as s,s as t,l as i,_ as a}from"./index-d2POsy9f.js";import{j as o,m as n}from"./ui-B2BnIfZo.js";import{u as r,r as l,L as c}from"./vendor-stn_h8-h.js";import{c as d}from"./utils-Dnvf9ysO.js";const m=d((e=>({notification:{isVisible:!1,type:"info",message:"",autoCloseTime:5e3,position:"top",showIcon:!0},showNotification:s=>{e({notification:{isVisible:!0,type:s.type||"info",message:s.message||"",autoCloseTime:void 0!==s.autoCloseTime?s.autoCloseTime:5e3,position:s.position||"top",showIcon:void 0===s.showIcon||s.showIcon}})},hideNotification:()=>{e((e=>({notification:{...e.notification,isVisible:!1}})))},showSuccess:(s,t={})=>{e({notification:{isVisible:!0,type:"success",message:s,autoCloseTime:void 0!==t.autoCloseTime?t.autoCloseTime:5e3,position:t.position||"top",showIcon:void 0===t.showIcon||t.showIcon}})},showError:(s,t={})=>{e({notification:{isVisible:!0,type:"error",message:s,autoCloseTime:void 0!==t.autoCloseTime?t.autoCloseTime:5e3,position:t.position||"top",showIcon:void 0===t.showIcon||t.showIcon}})},showInfo:(s,t={})=>{e({notification:{isVisible:!0,type:"info",message:s,autoCloseTime:void 0!==t.autoCloseTime?t.autoCloseTime:5e3,position:t.position||"top",showIcon:void 0===t.showIcon||t.showIcon}})},showWarning:(s,t={})=>{e({notification:{isVisible:!0,type:"warning",message:s,autoCloseTime:void 0!==t.autoCloseTime?t.autoCloseTime:5e3,position:t.position||"top",showIcon:void 0===t.showIcon||t.showIcon}})}}))),u=({products:d,updateProductStock:u})=>{const h=r(),{items:x,getCartTotal:p,getCartOriginalTotal:g,getCartSavings:f,clearCart:j}=e(),{addNotification:y}=m(),[b,N]=l.useState(!0),[v,w]=l.useState(!1),[C,S]=l.useState(!1),[I,T]=l.useState({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:"Tunisia"});l.useEffect((()=>{const e=sessionStorage.getItem("orderCompleted");0!==x.length||C||e||h("/cart");const s=setTimeout((()=>{N(!1)}),600);return()=>clearTimeout(s)}),[x,h,C]);const k=p(),O=g(),D=f(),q=k+7,P=e=>{const{name:s,value:t}=e.target;T((e=>({...e,[s]:t})))},F=e=>{d&&u&&e.forEach((e=>{const s=d.find((s=>s.id===e.id));if(s){const t=Math.max(0,s.stock-e.quantity);u(e.id,t),console.log(`Updated stock for ${e.name}: ${s.stock} -> ${t}`),t<5&&t>0?y({type:"info",message:`Low stock alert: Only ${t} units of "${e.name}" remaining.`}):0===t&&y({type:"warning",message:`"${e.name}" is now out of stock.`})}}))};return b?o.jsx("div",{className:"pt-24 pb-16 container",children:o.jsx("div",{className:"flex justify-center items-center h-96",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})})}):C?o.jsx("div",{className:"pt-24 pb-16",children:o.jsx("div",{className:"container max-w-3xl mx-auto",children:o.jsxs(n.div,{className:"bg-white rounded-lg shadow-md p-8 text-center",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},children:[o.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:o.jsx(s,{className:"text-green-600 text-3xl"})}),o.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Order Confirmed!"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Thank you for your purchase. Your order has been received and is being processed. You will receive a confirmation email shortly."}),o.jsxs("p",{className:"text-amber-600 mb-8 text-sm font-medium",children:["If you don't receive an order confirmation email within 6 hours, please contact us at ",o.jsx("a",{href:"mailto:barninzshop@gmail.com",className:"underline hover:text-amber-700",children:"barninzshop@gmail.com"})]}),o.jsxs("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg",children:[o.jsx("h3",{className:"font-bold mb-2",children:"Order Summary"}),o.jsxs("div",{className:"flex justify-between mb-2",children:[o.jsx("span",{children:"Order Number:"}),o.jsx("span",{className:"font-medium",children:sessionStorage.getItem("orderNumber")||"ORD-"+Math.floor(1e4*Math.random()).toString().padStart(4,"0")})]}),o.jsxs("div",{className:"flex justify-between mb-2",children:[o.jsx("span",{children:"Order Date:"}),o.jsx("span",{className:"font-medium",children:sessionStorage.getItem("orderDate")||(new Date).toLocaleDateString()})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Total Amount:"}),o.jsx("span",{className:"font-bold",children:sessionStorage.getItem("orderTotal")?`${sessionStorage.getItem("orderTotal")} TND`:t(q)})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[o.jsx(c,{to:"/products",className:"btn btn-primary",children:"Continue Shopping"}),o.jsx(c,{to:"/",className:"btn btn-outline",children:"Back to Home"})]})]})})}):o.jsx("div",{className:"pt-24 pb-16",children:o.jsxs("div",{className:"container",children:[o.jsx("div",{className:"mb-8",children:o.jsxs(c,{to:"/cart",className:"flex items-center text-primary-600 hover:underline",children:[o.jsx(i,{className:"mr-2"})," Back to Cart"]})}),o.jsx(n.h1,{className:"text-3xl font-bold mb-8 text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:"Checkout"}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-6xl mx-auto",children:[o.jsx("div",{className:"lg:col-span-2",children:o.jsx(n.div,{className:"bg-white rounded-lg shadow-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:o.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(!0);const s=(()=>{if(!d)return{success:!0,insufficientItems:[]};const e=[];for(const s of x){const t=d.find((e=>e.id===s.id));t?t.stock<s.quantity&&e.push({id:s.id,name:s.name,requested:s.quantity,available:t.stock,message:`Only ${t.stock} units available`}):e.push({id:s.id,name:s.name,message:"Product not found in inventory"})}return{success:0===e.length,insufficientItems:e}})();if(!s.success)return w(!1),y({type:"error",message:"Some items in your cart are out of stock"}),sessionStorage.setItem("insufficientItems",JSON.stringify(s.insufficientItems)),void h("/cart");const t={customer:{firstName:I.firstName,lastName:I.lastName,email:I.email,phone:I.phone,address:I.address,city:I.city,state:I.state,zipCode:I.zipCode,country:I.country},items:x.map((e=>{const s=e.finalPrice||e.price,t=e.originalPrice||e.price,i=e.discountPercentage||0;return{...e,finalPrice:s,originalPrice:t,discountPercentage:i,itemTotal:s*e.quantity,savings:t!==s?(t-s)*e.quantity:0}})),payment:{method:"Cash on Delivery",subtotal:k,originalSubtotal:O,totalSavings:D,shipping:7,total:q,status:"Pending - Payment on Delivery"},orderDate:(new Date).toISOString(),orderNumber:"ORD-"+Math.floor(1e4*Math.random()).toString().padStart(4,"0")};try{sessionStorage.setItem("orderItems",JSON.stringify(x)),F(x);try{const{sendOrderNotification:e}=await a((async()=>{const{sendOrderNotification:e}=await import("./emailService-BXGQaSIL.js");return{sendOrderNotification:e}}),[]),s=await e(t);s&&!1===s.success&&console.error("Email notification failed:",s.error)}catch(i){console.error("Email service error:",i)}setTimeout((()=>{sessionStorage.setItem("orderCompleted","true"),sessionStorage.setItem("orderNumber",t.orderNumber),sessionStorage.setItem("orderDate",(new Date).toLocaleDateString()),sessionStorage.setItem("orderTotal",q.toFixed(2)),w(!1),S(!0),j()}),1500)}catch(o){console.error("Order process error:",o),sessionStorage.setItem("orderItems",JSON.stringify(x)),F(x),setTimeout((()=>{sessionStorage.setItem("orderCompleted","true"),sessionStorage.setItem("orderNumber",t.orderNumber),sessionStorage.setItem("orderDate",(new Date).toLocaleDateString()),sessionStorage.setItem("orderTotal",q.toFixed(2)),w(!1),S(!0),j()}),1500)}},children:[o.jsx("div",{className:"p-6 border-b border-gray-200",children:o.jsx("h2",{className:"text-xl font-bold",children:"Shipping Information"})}),o.jsxs("div",{className:"p-6 space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"firstName",className:"block text-gray-700 font-medium mb-2",children:"First Name"}),o.jsx("input",{type:"text",id:"firstName",name:"firstName",value:I.firstName,onChange:P,className:"input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"lastName",className:"block text-gray-700 font-medium mb-2",children:"Last Name"}),o.jsx("input",{type:"text",id:"lastName",name:"lastName",value:I.lastName,onChange:P,className:"input",required:!0})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-medium mb-2",children:"Email Address"}),o.jsx("input",{type:"email",id:"email",name:"email",value:I.email,onChange:P,className:"input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"phone",className:"block text-gray-700 font-medium mb-2",children:"Phone Number"}),o.jsx("input",{type:"tel",id:"phone",name:"phone",value:I.phone,onChange:P,className:"input",required:!0})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"address",className:"block text-gray-700 font-medium mb-2",children:"Address"}),o.jsx("input",{type:"text",id:"address",name:"address",value:I.address,onChange:P,className:"input",required:!0})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"col-span-2",children:[o.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-medium mb-2",children:"City"}),o.jsx("input",{type:"text",id:"city",name:"city",value:I.city,onChange:P,className:"input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-medium mb-2",children:"State"}),o.jsx("input",{type:"text",id:"state",name:"state",value:I.state,onChange:P,className:"input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"zipCode",className:"block text-gray-700 font-medium mb-2",children:"ZIP Code"}),o.jsx("input",{type:"text",id:"zipCode",name:"zipCode",value:I.zipCode,onChange:P,className:"input",required:!0})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-medium mb-2",children:"Country"}),o.jsxs("select",{id:"country",name:"country",value:I.country,onChange:P,className:"input",required:!0,children:[o.jsx("option",{value:"Tunisia",children:"Tunisia"}),o.jsx("option",{value:"United States",children:"United States"}),o.jsx("option",{value:"Canada",children:"Canada"}),o.jsx("option",{value:"United Kingdom",children:"United Kingdom"}),o.jsx("option",{value:"Australia",children:"Australia"}),o.jsx("option",{value:"France",children:"France"}),o.jsx("option",{value:"Germany",children:"Germany"}),o.jsx("option",{value:"Japan",children:"Japan"})]})]})]}),o.jsx("div",{className:"p-6 bg-gray-50 flex justify-end",children:o.jsx(n.button,{type:"submit",className:"btn btn-primary",whileHover:{scale:1.02},whileTap:{scale:.98},disabled:v,children:v?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-t-2 border-b-2 border-white rounded-full"}),"Processing..."]}):"Complete Order (Cash on Delivery)"})})]})})}),o.jsx(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5},children:o.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-24",children:[o.jsx("h2",{className:"text-xl font-bold mb-6",children:"Order Summary"}),o.jsxs("div",{className:"space-y-4 mb-6",children:[o.jsx("div",{className:"max-h-60 overflow-y-auto mb-4",children:x.map((e=>{const s=e.finalPrice||e.price,i=e.originalPrice||e.price,a=i>s,n=a?Math.round(100*(1-s/i)):0,r=d?d.find((s=>s.id===e.id)):null,l=r&&r.stock<10&&r.stock>0,c=r&&0===r.stock,m=r&&r.stock<e.quantity;return o.jsxs("div",{className:"flex items-center py-2 border-b border-gray-100",children:[o.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-md overflow-hidden mr-3",children:e.image?o.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="/placeholder-product.png"}}):o.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200 text-gray-400 text-xs",children:"No image"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"text-sm font-medium",children:e.name}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsxs("span",{children:["Qty: ",e.quantity]}),o.jsx("span",{className:"font-medium",children:t(s*e.quantity)})]}),a&&o.jsxs("div",{className:"text-xs text-right",children:[o.jsx("span",{className:"line-through text-gray-500",children:t(i*e.quantity)}),o.jsxs("span",{className:"ml-1 text-red-500",children:["(",n,"% off)"]})]}),c&&o.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Out of stock"}),!c&&m&&o.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Only ",r.stock," available"]}),!m&&l&&o.jsxs("div",{className:"text-xs text-amber-600 mt-1",children:["Low stock: ",r.stock," left"]})]})]},e.id)}))}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Subtotal"}),o.jsx("span",{className:"font-medium",children:t(k)})]}),D>0&&o.jsxs("div",{className:"flex justify-between text-green-600",children:[o.jsx("span",{children:"Savings"}),o.jsxs("span",{children:["-",t(D)]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Shipping"}),o.jsx("span",{className:"font-medium",children:t(7)})]}),o.jsxs("div",{className:"border-t border-gray-200 pt-4 flex justify-between",children:[o.jsx("span",{className:"font-bold",children:"Total"}),o.jsx("span",{className:"font-bold text-xl",children:t(q)})]})]})]})})]})]})})};export{u as default};
