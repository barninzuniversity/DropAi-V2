class e{constructor(e=0,t="Network Error"){this.status=e,this.text=t}}const t={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:(()=>{if("undefined"!=typeof localStorage)return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}})()},i=e=>e?"string"==typeof e?{publicKey:e}:"[object Object]"===e.toString()?e:{}:{},r=async(i,r,o={})=>{const a=await fetch(t.origin+i,{method:"POST",headers:o,body:r}),s=await a.text(),n=new e(a.status,s);if(a.ok)return n;throw n},o=(e,t,i)=>{if(!e||"string"!=typeof e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||"string"!=typeof t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!i||"string"!=typeof i)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},a=e=>e.webdriver||!e.languages||0===e.languages.length,s=()=>new e(451,"Unavailable For Headless Browser"),n=(e,t)=>{if((e=>{var t;return!(null==(t=e.list)?void 0:t.length)||!e.watchVariable})(e))return!1;((e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if("string"!=typeof t)throw"The BlockList watchVariable has to be a string"})(e.list,e.watchVariable);const i=(r=t,o=e.watchVariable,r instanceof FormData?r.get(o):r[o]);var r,o;return"string"==typeof i&&e.list.includes(i)},c=()=>new e(403,"Forbidden"),l=async(e,t,i)=>{if(!t.throttle||!i)return!1;((e,t)=>{if("number"!=typeof e||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&"string"!=typeof t)throw"The LimitRate ID has to be a non-empty string"})(t.throttle,t.id);const r=t.id||e,o=await(async(e,t,i)=>{const r=Number(await i.get(e)||0);return t-Date.now()+r})(r,t.throttle,i);return o>0||(await i.set(r,Date.now().toString()),!1)},m=()=>new e(429,"Too Many Requests"),d=(e,r="https://api.emailjs.com")=>{if(!e)return;const o=i(e);t.publicKey=o.publicKey,t.blockHeadless=o.blockHeadless,t.storageProvider=o.storageProvider,t.blockList=o.blockList,t.limitRate=o.limitRate,t.origin=o.origin||r},u=async(e,d,u,p)=>{const f=i(p),h=f.publicKey||t.publicKey,g=f.blockHeadless||t.blockHeadless,b=f.storageProvider||t.storageProvider,y={...t.blockList,...f.blockList},w={...t.limitRate,...f.limitRate};if(g&&a(navigator))return Promise.reject(s());if(o(h,e,d),(e=>{if(e&&"[object Object]"!==e.toString())throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"})(u),u&&n(y,u))return Promise.reject(c());if(await l(location.pathname,w,b))return Promise.reject(m());const v={lib_version:"4.4.1",user_id:h,service_id:e,template_id:d,template_params:u};return r("/api/v1.0/email/send",JSON.stringify(v),{"Content-type":"application/json"})},p="service_ajy98zs",f="template_cd90pq4",h="template_fqksc1b",g="template_cd90pq4",b="UdcfTjWd3qtjfkrih",y="barninzshop@gmail.com";let w=!1;const v=async()=>{if(w)return!0;try{if(b)return d(b),w=!0,!0}catch(e){return console.error("Failed to initialize EmailJS:",e),!1}},_=async e=>{try{if(!w){if(!(await v()))return console.error("EmailJS initialization failed. Email services are unavailable."),{success:!1,error:"Email service is not available",details:{message:"EmailJS initialization failed"}}}0;const i=e.items.map((e=>`${e.name} (${e.quantity}) - $${(e.price*e.quantity).toFixed(2)}`)).join("\n"),r=e.items.reduce(((e,t)=>e+t.price*t.quantity),0),o=r>100?0:10,a=.08*r,s=r+o+a,n={to_email:y,from_name:`${e.customer.firstName} ${e.customer.lastName}`,from_email:e.customer.email||y,order_number:e.orderNumber,order_date:new Date(e.orderDate).toLocaleDateString(),customer_name:`${e.customer.firstName} ${e.customer.lastName}`,customer_email:e.customer.email||"Not provided",customer_phone:e.customer.phone||"Not provided",shipping_address:`${e.customer.address}, ${e.customer.city}, ${e.customer.state} ${e.customer.zipCode}, ${e.customer.country}`,order_items:i,subtotal:`$${r.toFixed(2)}`,shipping:0===o?"Free":`$${o.toFixed(2)}`,tax:`$${a.toFixed(2)}`,total:`$${s.toFixed(2)}`,payment_method:e.payment.method,payment_status:e.payment.status};console.log("Sending order email to:",y);const c=await u(p,f,n);if(console.log("Order notification sent successfully:",c.text),e.customer.email)try{const t={...n,to_email:e.customer.email,from_email:y,from_name:"Barninz Shop"},i=await u(p,f,t);console.log("Order confirmation sent to customer:",i.text)}catch(t){console.error("Failed to send confirmation to customer:",t)}else console.log("No customer email provided, skipping customer confirmation email");return c}catch(i){return console.error("Failed to send order notification:",i),console.error("Error details:",i.message),i.text&&console.error("Error text:",i.text),{success:!1,error:i.message||"Failed to send email notification",details:i}}},$=async e=>{try{if(!w){if(!(await v()))return console.error("EmailJS initialization failed. Email services are unavailable."),{success:!1,error:"Email service is not available",details:{message:"EmailJS initialization failed"}}}0;const t={to_email:y,from_name:e.name,from_email:e.email,subject:e.subject||"Contact Form Submission",message:e.message},i=await u(p,h,t,b);return console.log("Contact form sent successfully:",i.text),i}catch(t){return console.error("Failed to send contact form:",t),{success:!1,error:t.message||"Failed to send contact form",details:t}}},F=async(e,t)=>{try{if(!w){if(!(await v()))return console.error("EmailJS initialization failed. Email services are unavailable."),{success:!1,error:"Email service is not available",details:{message:"EmailJS initialization failed"}}}0;const i=e.discount>0?`$${(e.price-e.price*(e.discount/100)).toFixed(2)} (${e.discount}% OFF)`:`$${e.price.toFixed(2)}`,r={to_email:t,from_email:y,product_name:e.name,product_price:i,product_description:e.description,product_url:`${window.location.origin}/products/${e.id}`,product_image:e.image},o=await u(p,g,r,b);return console.log("Product shared successfully:",o.text),o}catch(i){return console.error("Failed to share product:",i),{success:!1,error:i.message||"Failed to share product",details:i}}};export{v as initializeEmailJS,$ as sendContactForm,_ as sendOrderNotification,F as shareProductViaEmail};
