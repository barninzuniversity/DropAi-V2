class e{constructor(e=0,t="Network Error"){this.status=e,this.text=t}}const t={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:(()=>{if("undefined"!=typeof localStorage)return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}})()},r=e=>e?"string"==typeof e?{publicKey:e}:"[object Object]"===e.toString()?e:{}:{},o=async(r,o,i={})=>{const a=await fetch(t.origin+r,{method:"POST",headers:i,body:o}),s=await a.text(),n=new e(a.status,s);if(a.ok)return n;throw n},i=(e,t,r)=>{if(!e||"string"!=typeof e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||"string"!=typeof t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||"string"!=typeof r)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},a=e=>e.webdriver||!e.languages||0===e.languages.length,s=()=>new e(451,"Unavailable For Headless Browser"),n=(e,t)=>{if((e=>{var t;return!(null==(t=e.list)?void 0:t.length)||!e.watchVariable})(e))return!1;((e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if("string"!=typeof t)throw"The BlockList watchVariable has to be a string"})(e.list,e.watchVariable);const r=(o=t,i=e.watchVariable,o instanceof FormData?o.get(i):o[i]);var o,i;return"string"==typeof r&&e.list.includes(r)},l=()=>new e(403,"Forbidden"),c=async(e,t,r)=>{if(!t.throttle||!r)return!1;((e,t)=>{if("number"!=typeof e||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&"string"!=typeof t)throw"The LimitRate ID has to be a non-empty string"})(t.throttle,t.id);const o=t.id||e,i=await(async(e,t,r)=>{const o=Number(await r.get(e)||0);return t-Date.now()+o})(o,t.throttle,r);return i>0||(await r.set(o,Date.now().toString()),!1)},m=()=>new e(429,"Too Many Requests"),d=(e,o="https://api.emailjs.com")=>{if(!e)return;const i=r(e);t.publicKey=i.publicKey,t.blockHeadless=i.blockHeadless,t.storageProvider=i.storageProvider,t.blockList=i.blockList,t.limitRate=i.limitRate,t.origin=i.origin||o},u=async(e,d,u,h)=>{const p=r(h),g=p.publicKey||t.publicKey,f=p.blockHeadless||t.blockHeadless,b=p.storageProvider||t.storageProvider,y={...t.blockList,...p.blockList},w={...t.limitRate,...p.limitRate};if(f&&a(navigator))return Promise.reject(s());if(i(g,e,d),(e=>{if(e&&"[object Object]"!==e.toString())throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"})(u),u&&n(y,u))return Promise.reject(l());if(await c(location.pathname,w,b))return Promise.reject(m());const v={lib_version:"4.4.1",user_id:g,service_id:e,template_id:d,template_params:u};return o("/api/v1.0/email/send",JSON.stringify(v),{"Content-type":"application/json"})},h="*********************",p="*********************",g="*******************",f="barninzshop@gmail.com";let b=!1;const y=async()=>{if(b)return!0;try{if(g)return d(g),b=!0,!0}catch(e){return console.error("Failed to initialize EmailJS:",e),!1}},w=async e=>{try{if(!b){if(!(await y()))return console.error("EmailJS initialization failed. Email services are unavailable."),{success:!1,error:"Email service is not available",details:{message:"EmailJS initialization failed"}}}0;const r=e.items.map((e=>`${e.name} (${e.quantity}) - $${(e.price*e.quantity).toFixed(2)}`)).join("\n"),o=e.items.reduce(((e,t)=>e+t.price*t.quantity),0),i=o>100?0:10,a=.08*o,s=o+i+a,n={to_email:f,from_name:`${e.customer.firstName} ${e.customer.lastName}`,from_email:e.customer.email||f,order_number:e.orderNumber,order_date:new Date(e.orderDate).toLocaleDateString(),customer_name:`${e.customer.firstName} ${e.customer.lastName}`,customer_email:e.customer.email||"Not provided",customer_phone:e.customer.phone||"Not provided",shipping_address:`${e.customer.address}, ${e.customer.city}, ${e.customer.state} ${e.customer.zipCode}, ${e.customer.country}`,order_items:r,subtotal:`$${o.toFixed(2)}`,shipping:0===i?"Free":`$${i.toFixed(2)}`,tax:`$${a.toFixed(2)}`,total:`$${s.toFixed(2)}`,payment_method:e.payment.method,payment_status:e.payment.status};console.log("Sending order email to:",f);const l=await u(h,p,n);if(console.log("Order notification sent successfully:",l.text),e.customer.email)try{const t={...n,to_email:e.customer.email,from_email:f,from_name:"Barninz Shop"},r=await u(h,p,t);console.log("Order confirmation sent to customer:",r.text)}catch(t){console.error("Failed to send confirmation to customer:",t)}else console.log("No customer email provided, skipping customer confirmation email");return l}catch(r){return console.error("Failed to send order notification:",r),console.error("Error details:",r.message),r.text&&console.error("Error text:",r.text),{success:!1,error:r.message||"Failed to send email notification",details:r}}};export{y as initializeEmailJS,w as sendOrderNotification};
